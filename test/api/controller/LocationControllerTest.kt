package api.controller

import com.meetAt.api.model.CenterRequest
import com.meetAt.api.model.LatLngRequest
import com.meetAt.module
import io.ktor.client.HttpClient
import io.ktor.client.engine.mock.MockEngine
import io.ktor.client.engine.mock.respond
import io.ktor.config.MapApplicationConfig
import io.ktor.http.*
import io.ktor.server.testing.handleRequest
import io.ktor.server.testing.setBody
import io.ktor.server.testing.withTestApplication
import io.ktor.util.KtorExperimentalAPI
import kotlin.test.Test
import kotlin.test.assertEquals

class LocationControllerTest {

    private val Url.hostWithPortIfRequired: String get() = if (port == protocol.defaultPort) host else hostWithPort
    private val Url.fullUrl: String get() = "${protocol.name}://$hostWithPortIfRequired$fullPath"

    private fun createMockedClient(): HttpClient {
        return HttpClient(MockEngine) {
            engine {
                addHandler { request ->
                    when (request.url.fullUrl) {
                        "http://localhost:8081/v1/nearby/nearby_locations" -> {
                            when (request.method) {
                                HttpMethod.Get -> {
                                    val responseHeaders = headersOf("Content-Type" to listOf(ContentType.Application.Json.toString()))
                                    respond("[{\"geometry\":{\"location\":{\"lat\":44.886898,\"lng\":-93.277683},\"viewport\":{\"northeast\":{\"lat\":44.8882033302915,\"lng\":-93.2765380197085},\"southwest\":{\"lat\":44.8855053697085,\"lng\":-93.2792359802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"b540a23c03f86b7673aa2ffde1ac8b82903f5791\",\"name\":\"Vina Vietnamese Restaurant\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117696470023491276608\\\">Morgan Atchison</a>\"],\"photo_reference\":\"CmRaAAAAODcTmBDebSVi4zOpa2FwsrAF8dW1jIElTkgzrFyjHhUvpPUWHN-00U76nVD9vSY8RxAU2E9QCmrORZfYOpLNX3ORk7KXizSUWwCqY0xsK9ztAF_4NZdqcxeHQYdKQcm7EhAnj7_4L7LjBZnoAJC9IJ7vGhS1_4Es7Nb781joK1er-OWr30fm-A\",\"width\":4032}],\"place_id\":\"ChIJj_H0Rg0m9ocR5p8re8dY7bM\",\"plus_code\":{\"compound_code\":\"VPPC+QW Richfield, Minnesota, United States\",\"global_code\":\"86P8VPPC+QW\"},\"price_level\":2,\"rating\":4.2,\"reference\":\"ChIJj_H0Rg0m9ocR5p8re8dY7bM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":270,\"vicinity\":\"6401 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8838654,\"lng\":-93.2498087},\"viewport\":{\"northeast\":{\"lat\":44.8853113302915,\"lng\":-93.2485848197085},\"southwest\":{\"lat\":44.8826133697085,\"lng\":-93.2512827802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/cafe-71.png\",\"id\":\"8162373ec4cdf883da18960bdf04641ce5ad4cd7\",\"name\":\"Caribou Coffee\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/115122725549031991505\\\">Teri S</a>\"],\"photo_reference\":\"CmRaAAAA9_9zWbT_uqysBors5sUWq4V5zCRBQDCi5_7qODajlg5KcM9vId4d4rz25wDCECOWS0cfrnFbCwY0T32pUz-zZ9GxGIYpbjsVNu-tZk8vVD-o91nhWNG_nXvEBy81KVtDEhAbgAZ0yLzt0HjfSTbad4BkGhR06DXBdOuBypPOo2UbOI_KWW9QHg\",\"width\":3024}],\"place_id\":\"ChIJC4y1Cq4o9ocRMyJc4gURaEc\",\"plus_code\":{\"compound_code\":\"VQM2+G3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+G3\"},\"price_level\":2,\"rating\":4.2,\"reference\":\"ChIJC4y1Cq4o9ocRMyJc4gURaEc\",\"scope\":\"GOOGLE\",\"types\":[\"cafe\",\"bakery\",\"restaurant\",\"food\",\"point_of_interest\",\"store\",\"establishment\"],\"user_ratings_total\":342,\"vicinity\":\"1700 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883889,\"lng\":-93.2489526},\"viewport\":{\"northeast\":{\"lat\":44.8852384302915,\"lng\":-93.24768846970848},\"southwest\":{\"lat\":44.8825404697085,\"lng\":-93.2503864302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"1a3c5a55aff80501238afc471e193f87805b8431\",\"name\":\"Subway\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3264,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117601442350291199874\\\">Matt Ovrebo</a>\"],\"photo_reference\":\"CmRaAAAA2nt6DqOr7pB7yLV3H7HRAmzd63qhvaCNN2gzS2XZ1aNct0Ixt-1rvAwvNjJmnC_G7CDaDbb3AWeQhV3xfEQEBPFfvpHun2vzqS4pzyecVuoYV_3IcAau9W9LRHv1jn2rEhCU98blB1tJi7kuHHtirC7zGhRE1TAgIVB03L3Pgcr5OsfQnzGcVQ\",\"width\":1836}],\"place_id\":\"ChIJJ09zB64o9ocRbZNFFY5LSK4\",\"plus_code\":{\"compound_code\":\"VQM2+HC Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HC\"},\"price_level\":1,\"rating\":3.6,\"reference\":\"ChIJJ09zB64o9ocRbZNFFY5LSK4\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":63,\"vicinity\":\"1800 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.884484,\"lng\":-93.278559},\"viewport\":{\"northeast\":{\"lat\":44.88570508029149,\"lng\":-93.2771508197085},\"southwest\":{\"lat\":44.88300711970849,\"lng\":-93.2798487802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"518bd5068905d326bfd71baf38a22b81787ad46a\",\"name\":\"China Garden Restaurant\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/110999020310177578385\\\">Keith Skinner</a>\"],\"photo_reference\":\"CmRaAAAAiyJTbFSMcPT0JJDdfhEE0ZPjLpaySsHBEhKZjVOrrQ18DzDLHFe0n2Bgz9NWYgbYNQCi53oaHeVGZWnztNjzoILwgX2-pZA-XWS1T4R2xDtTsNSx8oY-Z4wy2Ar1sc8lEhCz77tfImjbdb-Yy7YkXhccGhQxAXO25J3cyW9JKbbMciaLoEoGVw\",\"width\":4032}],\"place_id\":\"ChIJ93hLrAwm9ocRX_mzPizpCRI\",\"plus_code\":{\"compound_code\":\"VPMC+QH Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPMC+QH\"},\"price_level\":1,\"rating\":3.8,\"reference\":\"ChIJ93hLrAwm9ocRX_mzPizpCRI\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":197,\"vicinity\":\"4 West 66th Street, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.8841565,\"lng\":-93.2774215},\"viewport\":{\"northeast\":{\"lat\":44.8855428302915,\"lng\":-93.27618201970849},\"southwest\":{\"lat\":44.8828448697085,\"lng\":-93.2788799802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"2c90f97a47f8c04436366258292181b2ead1e09d\",\"name\":\"American Pie Pizza\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":960,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/105472216309625112982\\\">American Pie Pizza</a>\"],\"photo_reference\":\"CmRaAAAAHCqOtpMlbnHWSEC_81bYf6byM7IkpSjKUhReUDhXzatZISSTfct1y0DyfXsf4-S2syOKyC9Uvvnp7ZqkFzAb9_W8GtTYB4kF4FNjeYOfYvpx8-6cv2uWj5vh8wJ44M_kEhCxGZqHzT_ruE39S8Z5N3BNGhSjTI07tD686JUAOMCW5FVtCmgxdQ\",\"width\":720}],\"place_id\":\"ChIJC6z3tgwm9ocR4G2_DGAu1KQ\",\"plus_code\":{\"compound_code\":\"VPMF+M2 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+M2\"},\"price_level\":2,\"rating\":3.4,\"reference\":\"ChIJC6z3tgwm9ocR4G2_DGAu1KQ\",\"scope\":\"GOOGLE\",\"types\":[\"meal_delivery\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":298,\"vicinity\":\"6529 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88514439999999,\"lng\":-93.2674299},\"viewport\":{\"northeast\":{\"lat\":44.8865522802915,\"lng\":-93.26576541970849},\"southwest\":{\"lat\":44.8838543197085,\"lng\":-93.2684633802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png\",\"id\":\"a763b711824a8476e8012ac18a5ecf31d0346e28\",\"name\":\"Minneapolis/Richfield American Legion Post 435\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":2620,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/116626780391882142695\\\">Mitzi Beliveau</a>\"],\"photo_reference\":\"CmRaAAAAiF4YHpqaAenvfNENuxIgeWfRLGJ7FQRR9GEGgfpMGMX9mm0OjHudcgePU4eBj_F9hfi9Cj7zywH8WiQk8nuiesMBIGs_oUMVNDbdke_GsbymFtg2Zcj5jonmVqAJZoNfEhAw1Av715FKzrqbFfy8BVfEGhQjuR_djLLzy61Wpgpc1ahjgOUCeg\",\"width\":3904}],\"place_id\":\"ChIJSRlqpAUm9ocRF8xa5O2mgt0\",\"plus_code\":{\"compound_code\":\"VPPM+32 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPPM+32\"},\"rating\":4.3,\"reference\":\"ChIJSRlqpAUm9ocRF8xa5O2mgt0\",\"scope\":\"GOOGLE\",\"types\":[\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":394,\"vicinity\":\"6501 Portland Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88445929999999,\"lng\":-93.2794061},\"viewport\":{\"northeast\":{\"lat\":44.88576623029149,\"lng\":-93.2781219697085},\"southwest\":{\"lat\":44.8830682697085,\"lng\":-93.2808199302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"1b615094d42c4cdd49de02a8280e343ffae6d856\",\"name\":\"Little Caesars Pizza\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1000,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107378325034706733146\\\">Little Caesars Pizza</a>\"],\"photo_reference\":\"CmRaAAAAS8SjtxxMlmCJnjCCENxHdJMhB6KkntnXTa3JUQmp1UAmV94D1kpMjcs_q82iRMvrwINjh7Q9CjLv8Y1zJN3P7PZCW6BammyxxXCSqs3kYS_mEbFa6B4bV57vY64VvZ05EhC9RDAuZ7yGS83rh0yhB6veGhQVEKPjOZvztmvjInkhc221221mfw\",\"width\":1000}],\"place_id\":\"ChIJqzgnU3Mm9ocRcMZ0m_g_gks\",\"plus_code\":{\"compound_code\":\"VPMC+Q6 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMC+Q6\"},\"price_level\":1,\"rating\":3.2,\"reference\":\"ChIJqzgnU3Mm9ocRcMZ0m_g_gks\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":124,\"vicinity\":\"20 West 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8926236,\"lng\":-93.27864249999999},\"viewport\":{\"northeast\":{\"lat\":44.8939711802915,\"lng\":-93.2771599197085},\"southwest\":{\"lat\":44.8912732197085,\"lng\":-93.2798578802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/bar-71.png\",\"id\":\"5b21e36d349456e15312a315e878a343cc70b04a\",\"name\":\"Tailgate Sports Cafe, Best Sports Bar in South Minneapolis\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/113100355490185193575\\\">Banle Gaar</a>\"],\"photo_reference\":\"CmRaAAAARJg9RZbCWxgVJ_aEVZ9AxsozbZqwJ3n4qHLItvWB6P7cTGzo6xdpIf_PIsMgQKNqW0JA0tMYVnZAnDg5PsmuqlNaLp3_i25226dLgidizBZccZoVFe2ZP3KseJaxCcFbEhAOpXedi1Yruz496ux5TWx8GhTh0867WTq-VrNt7wAYTswcLnDfQw\",\"width\":4032}],\"place_id\":\"ChIJoxkOrhQm9ocR2blyg9VOZrE\",\"plus_code\":{\"compound_code\":\"VPVC+2G Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+2G\"},\"price_level\":1,\"rating\":4.2,\"reference\":\"ChIJoxkOrhQm9ocR2blyg9VOZrE\",\"scope\":\"GOOGLE\",\"types\":[\"night_club\",\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":786,\"vicinity\":\"6050 Nicollet Avenue, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.8838392,\"lng\":-93.2773069},\"viewport\":{\"northeast\":{\"lat\":44.8851039302915,\"lng\":-93.27595396970851},\"southwest\":{\"lat\":44.8824059697085,\"lng\":-93.27865193029152}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"70d4c05240bc780903f6a0f13b3552e6462089c5\",\"name\":\"Subway\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107173731125562208165\\\">Saul Lagunas</a>\"],\"photo_reference\":\"CmRaAAAAQUQvqgztTSpV_88gedg_b1wEdO4EUGFt9ABcjJcvkG_q72RUV5Lxl5QEsePpzIBRTfJAQcWjh9i74FCiokviu1_e7DvFo70ICM7IYJRgqZks4Oo01Q8psVngSBH-tVwpEhBZEvvNckr2yfH4vmdF8CLWGhRq8tDGlAUFokPSNivgeAY7w8KMkg\",\"width\":2268}],\"place_id\":\"ChIJQxxoogwm9ocRDJmn9hKkt8Q\",\"plus_code\":{\"compound_code\":\"VPMF+G3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+G3\"},\"price_level\":1,\"rating\":3.6,\"reference\":\"ChIJQxxoogwm9ocRDJmn9hKkt8Q\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":42,\"vicinity\":\"10 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8845246,\"lng\":-93.2773587},\"viewport\":{\"northeast\":{\"lat\":44.88587443029149,\"lng\":-93.27614551970848},\"southwest\":{\"lat\":44.88317646970849,\"lng\":-93.2788434802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"d9f96c65d9966dc96344ff0c67f03df42a8895a7\",\"name\":\"El Tejaban Mexican Grill\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/101828333674428774151\\\">Linda Lopez</a>\"],\"photo_reference\":\"CmRaAAAA9WB_94yl7srTBFblt4gNRxWIT_c8Tq8r3QCw09rbHzitw3FVfhieoJ1pv48Wqfe0Z2U3WUpHe1v6lJule1jmz2mLhrzsFh-Y5qssdTKoOld2k1XvATIYonrcXTnW95TVEhAygshFIRJikBkaTbPhJKAgGhRv2NRHS2hPS_K-hzMbA373X2rXJw\",\"width\":4032}],\"place_id\":\"ChIJp1wUwQwm9ocRcd4qhKaPxt8\",\"plus_code\":{\"compound_code\":\"VPMF+R3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+R3\"},\"price_level\":2,\"rating\":4.1,\"reference\":\"ChIJp1wUwQwm9ocRcd4qhKaPxt8\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":713,\"vicinity\":\"6519 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88765220000001,\"lng\":-93.26733159999999},\"viewport\":{\"northeast\":{\"lat\":44.88900213029149,\"lng\":-93.26624416970849},\"southwest\":{\"lat\":44.8863041697085,\"lng\":-93.2689421302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"0f532d0931a607f5ab1bd45823a48ebe4fc01572\",\"name\":\"Wheel Fun Rentals\",\"photos\":[{\"height\":1365,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/108959973530893398684\\\">Wheel Fun Rentals</a>\"],\"photo_reference\":\"CmRaAAAAR7Y-BATZ1--V-LAMicKgjWNje3NiBKWko95w8jBRApWqn_9NSM4oSer72fZW4MNF8Gc8cIJS16XoLZZ3QYD4bNOdi5NCKzkXMSVczGkdRw8HWix_jg1GFWMXUxX1TS_uEhBzNOr3Ntume3r1_GFkZrfjGhTvtGQtvdTMhATHVjoUxlBTcClvBQ\",\"width\":2048}],\"place_id\":\"ChIJy2AyUAUm9ocRtZuDx8OvUh4\",\"plus_code\":{\"compound_code\":\"VPQM+33 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPQM+33\"},\"rating\":3.1,\"reference\":\"ChIJy2AyUAUm9ocRtZuDx8OvUh4\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"store\",\"establishment\"],\"user_ratings_total\":64,\"vicinity\":\"6335 Portland Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8939568,\"lng\":-93.2778624},\"viewport\":{\"northeast\":{\"lat\":44.8954572302915,\"lng\":-93.27639866970848},\"southwest\":{\"lat\":44.8927592697085,\"lng\":-93.2790966302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"a6084aa38730aafb3302ed8b41189d0ee9b44453\",\"name\":\"Q fanatic Artisan BBQ\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/108794747643944972579\\\">Bob Dadabo</a>\"],\"photo_reference\":\"CmRaAAAArAlDOATo6GQhMg37zYAc9hWylWiQrvCllrU-9KL63_gFgMe4UugHvhTdGvs6N5xfwQ3sClRsYgZ89eXpFTqECILE_VekqiMlNrqY4oHxqMoe6MqVmd3jKITJsli7IO9TEhCRY4if3hSTa39-LEpBBzSmGhRtNPl7R8VjJwSvUjzzrp6_qV8bZA\",\"width\":4032}],\"place_id\":\"ChIJxx5fzxQm9ocRMPiaoJ83nwk\",\"plus_code\":{\"compound_code\":\"VPVC+HV Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+HV\"},\"price_level\":2,\"rating\":4.7,\"reference\":\"ChIJxx5fzxQm9ocRMPiaoJ83nwk\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":614,\"vicinity\":\"6009 Nicollet Avenue, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.88310139999999,\"lng\":-93.2775521},\"viewport\":{\"northeast\":{\"lat\":44.88452203029149,\"lng\":-93.27620036970849},\"southwest\":{\"lat\":44.88182406970849,\"lng\":-93.2788983302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd44d818999d317424143a358445387723f69033\",\"name\":\"Lakes Buffet\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":2269,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/105659331289179066133\\\">Lakes Buffet</a>\"],\"photo_reference\":\"CmRaAAAAOF-hoGyzLwzn_3XPRST2MtAhqeOlvW48mJ5CTIdcKiyVGk0zLymJzDaJttc-SdABJhuvu6P2zXSHUxFPb69xe91QpjkrY0JpQePJv4Hv1Ox3VPvg5rM-IypA7Tonf6_PEhBXXS9Z1nEBAeLqDSb0BK43GhRLQI6_yjI4xWNjkDX6HWtYPgZUHQ\",\"width\":4032}],\"place_id\":\"ChIJ1QE6-nMm9ocRIcOziE6FA5k\",\"plus_code\":{\"compound_code\":\"VPMC+6X Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMC+6X\"},\"price_level\":2,\"rating\":3.8,\"reference\":\"ChIJ1QE6-nMm9ocRIcOziE6FA5k\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":772,\"vicinity\":\"9 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883877,\"lng\":-93.25058899999999},\"viewport\":{\"northeast\":{\"lat\":44.88548218029149,\"lng\":-93.24904376970849},\"southwest\":{\"lat\":44.88278421970849,\"lng\":-93.2517417302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"80d7657adb244518afc35c0809fd89e625185652\",\"name\":\"Panda Express\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/113742889776870864311\\\">Bella Grace</a>\"],\"photo_reference\":\"CmRaAAAAZe2uAj3j_N7WXLRBZSet465fBtnmSJvTbOm90v5rLDhELOxc-CQoiAaVYWNUdQ0YwdKqyxkgf6LU_8eGYioQOl7SrBXQ4uVKBDJ2R7WL9LzPx7UGuJspxEBpmP9ifb1WEhD7FXidN21e7PfwTxtcjCykGhTs2DSwNlA41P5ATL54eam6Tc-Euw\",\"width\":4032}],\"place_id\":\"ChIJESu31a0o9ocR2TwYm9IwSoE\",\"plus_code\":{\"compound_code\":\"VPMX+HQ Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMX+HQ\"},\"price_level\":1,\"rating\":3.8,\"reference\":\"ChIJESu31a0o9ocR2TwYm9IwSoE\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":292,\"vicinity\":\"1638 East 66th Street E, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883969,\"lng\":-93.24833819999999},\"viewport\":{\"northeast\":{\"lat\":44.8854099302915,\"lng\":-93.24700296970848},\"southwest\":{\"lat\":44.8827119697085,\"lng\":-93.2497009302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd2b2ab189b8034b768839535c6da91a05ff5ccd\",\"name\":\"Five Guys\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117274020802757750584\\\">Paulette Kilgore</a>\"],\"photo_reference\":\"CmRaAAAAkUYLKU0sIWOyg3ukXnTy9QDYhbon_v6vwJaO4sp2tur7RSpw_0tg9lfr6fhsto3N6p5_KJE08gHSsiBDfmC20u2P2pXYvSuaj056FrG6GoQfNFrcx0Fp-Q6f48Ej7BB5EhCuMaan-VkB67nCvyXakFUPGhQFyTYMFwOPXEiRhNO0I4hC-6PVCg\",\"width\":3024}],\"place_id\":\"ChIJ82zdI4Qm9ocRkSbDFYXLWgM\",\"plus_code\":{\"compound_code\":\"VQM2+HM Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HM\"},\"price_level\":2,\"rating\":4.3,\"reference\":\"ChIJ82zdI4Qm9ocRkSbDFYXLWgM\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":548,\"vicinity\":\"1844 East 66th Street Suite 100, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8839582,\"lng\":-93.24851559999999},\"viewport\":{\"northeast\":{\"lat\":44.8853981302915,\"lng\":-93.24717931970848},\"southwest\":{\"lat\":44.88270016970851,\"lng\":-93.2498772802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"df59d034179ab09c9a5758086231a25bf2bc3ef1\",\"name\":\"Chipotle Mexican Grill\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1080,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/110907965834292552824\\\">A Hendrickson</a>\"],\"photo_reference\":\"CmRaAAAADOOXbiBvTTUklEWcrX61AE-bUzHVmqXzRNUMFKgF6Sh32SYjX7oZ3EhPf-Rs0ghM1xLXY8aSJkTQ2RvTdjAA--LZcFpTs-4OFfndk-YTMRxvjyB_v9IEL32lInoC_MyDEhDBk1gJBHfIxI4J07F2tJp1GhQGO33BV5TUWhGCxNhvzh_hkTAmUg\",\"width\":1920}],\"place_id\":\"ChIJ7T_X_a0o9ocRNzqdstQRrUg\",\"plus_code\":{\"compound_code\":\"VQM2+HH Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HH\"},\"price_level\":1,\"rating\":3.9,\"reference\":\"ChIJ7T_X_a0o9ocRNzqdstQRrUg\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":912,\"vicinity\":\"1830 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8838531,\"lng\":-93.28056289999999},\"viewport\":{\"northeast\":{\"lat\":44.88517613029149,\"lng\":-93.27931836970849},\"southwest\":{\"lat\":44.88247816970849,\"lng\":-93.2820163302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"dfa548c87ebff9e312b5f0cccef6af20fa76a75a\",\"name\":\"Burger King\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1080,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/106399984866392798901\\\">Tom B</a>\"],\"photo_reference\":\"CmRaAAAA-EIFUEQHTW0M1rR962Yn1G4JHYfKJHA045EPl5JGtJqZP2su5TG8i-o6A225i_GUltJQZKL5GSV2T3F7FM8U0CikU4_ngz0no5gFFq1w9LxoXXYwX7Q86Sf70YG7zOObEhCdKQMi4cAtvRirgiI9Lm6nGhQumSGrSIAsQaq-hhoNwsPb2Qvgaw\",\"width\":1920}],\"place_id\":\"ChIJvah2aHMm9ocRKpUbDd_7vTM\",\"plus_code\":{\"compound_code\":\"VPM9+GQ Richfield, Minnesota, United States\",\"global_code\":\"86P8VPM9+GQ\"},\"price_level\":1,\"rating\":3.4,\"reference\":\"ChIJvah2aHMm9ocRKpUbDd_7vTM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":363,\"vicinity\":\"96 West 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8831803,\"lng\":-93.2626615},\"viewport\":{\"northeast\":{\"lat\":44.8846934302915,\"lng\":-93.2613119697085},\"southwest\":{\"lat\":44.8819954697085,\"lng\":-93.26400993029151}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd72316db7c6c2f7b7caa54d39aab56830c727f5\",\"name\":\"i taco\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1365,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117140200442371672045\\\">jaime And Marcos i taco</a>\"],\"photo_reference\":\"CmRaAAAAzoCcdpPF_5YwViEc2odzn223vAPChV2meK0qTFu13tErEyquoYCFOLMrzkkk3J-IhnmXE0V-gpw7NDKfY1ravTkKHgsuJi1Cg1BxAPPPf6vxghF2lUNJdPyd_QAZbEAnEhCO7kE9_kyt1dNekHoYw284GhSsK2QFSDKLPl7hr9i7gus2X7GF1Q\",\"width\":2048}],\"place_id\":\"ChIJsbIgZqQn9ocRLAGNl1BWydI\",\"plus_code\":{\"compound_code\":\"VPMP+7W Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMP+7W\"},\"rating\":4.7,\"reference\":\"ChIJsbIgZqQn9ocRLAGNl1BWydI\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":29,\"vicinity\":\"813 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88314810000001,\"lng\":-93.2620952},\"viewport\":{\"northeast\":{\"lat\":44.88454383029151,\"lng\":-93.26055216970849},\"southwest\":{\"lat\":44.88184586970851,\"lng\":-93.2632501302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"40efc0c2c0430d1866320afef445ab34af6a56bf\",\"name\":\"Local Roots\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/100726915532117426719\\\">B Johnson Photos Brenda Johnson</a>\"],\"photo_reference\":\"CmRaAAAAMD6Mcqjjj65PpofgmjhG1oImGaznGY22dBPcuDuqOGzMS1_4lxVzjtPZyY-5EjL8M8y1Rx9lyeZI-mzdvJ_4BPwQIkSH5qsbz2rENaHqDfj4u1UQ2HlY9S9liTgb51GBEhAYO_YJNUPrQq2kiNafRA1SGhTKSmFDQZogbAFn6Cz9bnu6UFQEqg\",\"width\":4032}],\"place_id\":\"ChIJ6SJlZwEm9ocR8gWPM6qIWSs\",\"plus_code\":{\"compound_code\":\"VPMQ+75 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMQ+75\"},\"price_level\":2,\"rating\":4.6,\"reference\":\"ChIJ6SJlZwEm9ocR8gWPM6qIWSs\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":336,\"vicinity\":\"817 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8926872,\"lng\":-93.278604},\"viewport\":{\"northeast\":{\"lat\":44.89403498029149,\"lng\":-93.2771400197085},\"southwest\":{\"lat\":44.8913370197085,\"lng\":-93.2798379802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"7878f4b73288eb64c674ad963ecd0fbe88cd8730\",\"name\":\"The Patty Wagon, Best Burgers in South Minneapolis\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":324,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107665803766083058795\\\">The Patty Wagon, Best Burgers in South Minneapolis</a>\"],\"photo_reference\":\"CmRaAAAADaGerNAssI_aafnEskZzzXKynutWVO7IYo5VeYs9rqBKi3t_bXJgxD7rjiiksNEam26cfGz-l2HmURxH0OowyaFnH02eEsCwtHu-E4x_uq3WDzzxlDumZFFJmLdDrBLREhAnYt6aRoFGmDKBqpZ4AjveGhTWIYGb2BtZPxjdEwhC3H7TR-ADzw\",\"width\":432}],\"place_id\":\"ChIJeXu2VGsm9ocRXU4iEFSlzzw\",\"plus_code\":{\"compound_code\":\"VPVC+3H Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+3H\"},\"price_level\":1,\"rating\":4.4,\"reference\":\"ChIJeXu2VGsm9ocRXU4iEFSlzzw\",\"scope\":\"GOOGLE\",\"types\":[\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":482,\"vicinity\":\"6042 Nicollet Avenue, Minneapolis\"}]", headers = responseHeaders)
                                }
                                else -> error("Unhandled")
                            }
                        }
                        "http://localhost:8081/v1/locations/center" -> {
                            when (request.method) {
                                HttpMethod.Get -> {
                                    val responseHeaders = headersOf("Content-Type" to listOf(ContentType.Application.Json.toString()))
                                    respond("{\"lat\":44.9658,\"lng\":-93.1775}", headers = responseHeaders)
                                }
                                else -> error("Unhandled")
                            }
                        }
                        else -> error("Unhandled ${request.url.fullUrl}")
                    }
                }
            }
        }
    }

    @KtorExperimentalAPI
    @Test
    fun testNearByLocations() {
        withTestApplication({
            (environment.config as MapApplicationConfig).apply {
                put("ktor.service.authUrl", "http://localhost:8081/v1/")
                put("ktor.service.locationUrl", "http://localhost:8081/v1/")
            }
            module(client = createMockedClient())
        }) {
            handleRequest(HttpMethod.Get, "/nearby/nearby_locations") {
                addHeader(HttpHeaders.ContentType, ContentType.Application.Json.toString())
                setBody(LatLngRequest(44.889220, -93.2650).toJson())
            }.apply {
                assertEquals(HttpStatusCode.OK, response.status())
                assertEquals(
                    "[{\"geometry\":{\"location\":{\"lat\":44.886898,\"lng\":-93.277683},\"viewport\":{\"northeast\":{\"lat\":44.8882033302915,\"lng\":-93.2765380197085},\"southwest\":{\"lat\":44.8855053697085,\"lng\":-93.2792359802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"b540a23c03f86b7673aa2ffde1ac8b82903f5791\",\"name\":\"Vina Vietnamese Restaurant\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117696470023491276608\\\">Morgan Atchison</a>\"],\"photo_reference\":\"CmRaAAAAODcTmBDebSVi4zOpa2FwsrAF8dW1jIElTkgzrFyjHhUvpPUWHN-00U76nVD9vSY8RxAU2E9QCmrORZfYOpLNX3ORk7KXizSUWwCqY0xsK9ztAF_4NZdqcxeHQYdKQcm7EhAnj7_4L7LjBZnoAJC9IJ7vGhS1_4Es7Nb781joK1er-OWr30fm-A\",\"width\":4032}],\"place_id\":\"ChIJj_H0Rg0m9ocR5p8re8dY7bM\",\"plus_code\":{\"compound_code\":\"VPPC+QW Richfield, Minnesota, United States\",\"global_code\":\"86P8VPPC+QW\"},\"price_level\":2,\"rating\":4.2,\"reference\":\"ChIJj_H0Rg0m9ocR5p8re8dY7bM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":270,\"vicinity\":\"6401 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8838654,\"lng\":-93.2498087},\"viewport\":{\"northeast\":{\"lat\":44.8853113302915,\"lng\":-93.2485848197085},\"southwest\":{\"lat\":44.8826133697085,\"lng\":-93.2512827802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/cafe-71.png\",\"id\":\"8162373ec4cdf883da18960bdf04641ce5ad4cd7\",\"name\":\"Caribou Coffee\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/115122725549031991505\\\">Teri S</a>\"],\"photo_reference\":\"CmRaAAAA9_9zWbT_uqysBors5sUWq4V5zCRBQDCi5_7qODajlg5KcM9vId4d4rz25wDCECOWS0cfrnFbCwY0T32pUz-zZ9GxGIYpbjsVNu-tZk8vVD-o91nhWNG_nXvEBy81KVtDEhAbgAZ0yLzt0HjfSTbad4BkGhR06DXBdOuBypPOo2UbOI_KWW9QHg\",\"width\":3024}],\"place_id\":\"ChIJC4y1Cq4o9ocRMyJc4gURaEc\",\"plus_code\":{\"compound_code\":\"VQM2+G3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+G3\"},\"price_level\":2,\"rating\":4.2,\"reference\":\"ChIJC4y1Cq4o9ocRMyJc4gURaEc\",\"scope\":\"GOOGLE\",\"types\":[\"cafe\",\"bakery\",\"restaurant\",\"food\",\"point_of_interest\",\"store\",\"establishment\"],\"user_ratings_total\":342,\"vicinity\":\"1700 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883889,\"lng\":-93.2489526},\"viewport\":{\"northeast\":{\"lat\":44.8852384302915,\"lng\":-93.24768846970848},\"southwest\":{\"lat\":44.8825404697085,\"lng\":-93.2503864302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"1a3c5a55aff80501238afc471e193f87805b8431\",\"name\":\"Subway\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3264,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117601442350291199874\\\">Matt Ovrebo</a>\"],\"photo_reference\":\"CmRaAAAA2nt6DqOr7pB7yLV3H7HRAmzd63qhvaCNN2gzS2XZ1aNct0Ixt-1rvAwvNjJmnC_G7CDaDbb3AWeQhV3xfEQEBPFfvpHun2vzqS4pzyecVuoYV_3IcAau9W9LRHv1jn2rEhCU98blB1tJi7kuHHtirC7zGhRE1TAgIVB03L3Pgcr5OsfQnzGcVQ\",\"width\":1836}],\"place_id\":\"ChIJJ09zB64o9ocRbZNFFY5LSK4\",\"plus_code\":{\"compound_code\":\"VQM2+HC Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HC\"},\"price_level\":1,\"rating\":3.6,\"reference\":\"ChIJJ09zB64o9ocRbZNFFY5LSK4\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":63,\"vicinity\":\"1800 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.884484,\"lng\":-93.278559},\"viewport\":{\"northeast\":{\"lat\":44.88570508029149,\"lng\":-93.2771508197085},\"southwest\":{\"lat\":44.88300711970849,\"lng\":-93.2798487802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"518bd5068905d326bfd71baf38a22b81787ad46a\",\"name\":\"China Garden Restaurant\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/110999020310177578385\\\">Keith Skinner</a>\"],\"photo_reference\":\"CmRaAAAAiyJTbFSMcPT0JJDdfhEE0ZPjLpaySsHBEhKZjVOrrQ18DzDLHFe0n2Bgz9NWYgbYNQCi53oaHeVGZWnztNjzoILwgX2-pZA-XWS1T4R2xDtTsNSx8oY-Z4wy2Ar1sc8lEhCz77tfImjbdb-Yy7YkXhccGhQxAXO25J3cyW9JKbbMciaLoEoGVw\",\"width\":4032}],\"place_id\":\"ChIJ93hLrAwm9ocRX_mzPizpCRI\",\"plus_code\":{\"compound_code\":\"VPMC+QH Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPMC+QH\"},\"price_level\":1,\"rating\":3.8,\"reference\":\"ChIJ93hLrAwm9ocRX_mzPizpCRI\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":197,\"vicinity\":\"4 West 66th Street, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.8841565,\"lng\":-93.2774215},\"viewport\":{\"northeast\":{\"lat\":44.8855428302915,\"lng\":-93.27618201970849},\"southwest\":{\"lat\":44.8828448697085,\"lng\":-93.2788799802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"2c90f97a47f8c04436366258292181b2ead1e09d\",\"name\":\"American Pie Pizza\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":960,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/105472216309625112982\\\">American Pie Pizza</a>\"],\"photo_reference\":\"CmRaAAAAHCqOtpMlbnHWSEC_81bYf6byM7IkpSjKUhReUDhXzatZISSTfct1y0DyfXsf4-S2syOKyC9Uvvnp7ZqkFzAb9_W8GtTYB4kF4FNjeYOfYvpx8-6cv2uWj5vh8wJ44M_kEhCxGZqHzT_ruE39S8Z5N3BNGhSjTI07tD686JUAOMCW5FVtCmgxdQ\",\"width\":720}],\"place_id\":\"ChIJC6z3tgwm9ocR4G2_DGAu1KQ\",\"plus_code\":{\"compound_code\":\"VPMF+M2 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+M2\"},\"price_level\":2,\"rating\":3.4,\"reference\":\"ChIJC6z3tgwm9ocR4G2_DGAu1KQ\",\"scope\":\"GOOGLE\",\"types\":[\"meal_delivery\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":298,\"vicinity\":\"6529 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88514439999999,\"lng\":-93.2674299},\"viewport\":{\"northeast\":{\"lat\":44.8865522802915,\"lng\":-93.26576541970849},\"southwest\":{\"lat\":44.8838543197085,\"lng\":-93.2684633802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png\",\"id\":\"a763b711824a8476e8012ac18a5ecf31d0346e28\",\"name\":\"Minneapolis/Richfield American Legion Post 435\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":2620,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/116626780391882142695\\\">Mitzi Beliveau</a>\"],\"photo_reference\":\"CmRaAAAAiF4YHpqaAenvfNENuxIgeWfRLGJ7FQRR9GEGgfpMGMX9mm0OjHudcgePU4eBj_F9hfi9Cj7zywH8WiQk8nuiesMBIGs_oUMVNDbdke_GsbymFtg2Zcj5jonmVqAJZoNfEhAw1Av715FKzrqbFfy8BVfEGhQjuR_djLLzy61Wpgpc1ahjgOUCeg\",\"width\":3904}],\"place_id\":\"ChIJSRlqpAUm9ocRF8xa5O2mgt0\",\"plus_code\":{\"compound_code\":\"VPPM+32 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPPM+32\"},\"rating\":4.3,\"reference\":\"ChIJSRlqpAUm9ocRF8xa5O2mgt0\",\"scope\":\"GOOGLE\",\"types\":[\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":394,\"vicinity\":\"6501 Portland Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88445929999999,\"lng\":-93.2794061},\"viewport\":{\"northeast\":{\"lat\":44.88576623029149,\"lng\":-93.2781219697085},\"southwest\":{\"lat\":44.8830682697085,\"lng\":-93.2808199302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"1b615094d42c4cdd49de02a8280e343ffae6d856\",\"name\":\"Little Caesars Pizza\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1000,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107378325034706733146\\\">Little Caesars Pizza</a>\"],\"photo_reference\":\"CmRaAAAAS8SjtxxMlmCJnjCCENxHdJMhB6KkntnXTa3JUQmp1UAmV94D1kpMjcs_q82iRMvrwINjh7Q9CjLv8Y1zJN3P7PZCW6BammyxxXCSqs3kYS_mEbFa6B4bV57vY64VvZ05EhC9RDAuZ7yGS83rh0yhB6veGhQVEKPjOZvztmvjInkhc221221mfw\",\"width\":1000}],\"place_id\":\"ChIJqzgnU3Mm9ocRcMZ0m_g_gks\",\"plus_code\":{\"compound_code\":\"VPMC+Q6 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMC+Q6\"},\"price_level\":1,\"rating\":3.2,\"reference\":\"ChIJqzgnU3Mm9ocRcMZ0m_g_gks\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":124,\"vicinity\":\"20 West 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8926236,\"lng\":-93.27864249999999},\"viewport\":{\"northeast\":{\"lat\":44.8939711802915,\"lng\":-93.2771599197085},\"southwest\":{\"lat\":44.8912732197085,\"lng\":-93.2798578802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/bar-71.png\",\"id\":\"5b21e36d349456e15312a315e878a343cc70b04a\",\"name\":\"Tailgate Sports Cafe, Best Sports Bar in South Minneapolis\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/113100355490185193575\\\">Banle Gaar</a>\"],\"photo_reference\":\"CmRaAAAARJg9RZbCWxgVJ_aEVZ9AxsozbZqwJ3n4qHLItvWB6P7cTGzo6xdpIf_PIsMgQKNqW0JA0tMYVnZAnDg5PsmuqlNaLp3_i25226dLgidizBZccZoVFe2ZP3KseJaxCcFbEhAOpXedi1Yruz496ux5TWx8GhTh0867WTq-VrNt7wAYTswcLnDfQw\",\"width\":4032}],\"place_id\":\"ChIJoxkOrhQm9ocR2blyg9VOZrE\",\"plus_code\":{\"compound_code\":\"VPVC+2G Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+2G\"},\"price_level\":1,\"rating\":4.2,\"reference\":\"ChIJoxkOrhQm9ocR2blyg9VOZrE\",\"scope\":\"GOOGLE\",\"types\":[\"night_club\",\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":786,\"vicinity\":\"6050 Nicollet Avenue, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.8838392,\"lng\":-93.2773069},\"viewport\":{\"northeast\":{\"lat\":44.8851039302915,\"lng\":-93.27595396970851},\"southwest\":{\"lat\":44.8824059697085,\"lng\":-93.27865193029152}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"70d4c05240bc780903f6a0f13b3552e6462089c5\",\"name\":\"Subway\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107173731125562208165\\\">Saul Lagunas</a>\"],\"photo_reference\":\"CmRaAAAAQUQvqgztTSpV_88gedg_b1wEdO4EUGFt9ABcjJcvkG_q72RUV5Lxl5QEsePpzIBRTfJAQcWjh9i74FCiokviu1_e7DvFo70ICM7IYJRgqZks4Oo01Q8psVngSBH-tVwpEhBZEvvNckr2yfH4vmdF8CLWGhRq8tDGlAUFokPSNivgeAY7w8KMkg\",\"width\":2268}],\"place_id\":\"ChIJQxxoogwm9ocRDJmn9hKkt8Q\",\"plus_code\":{\"compound_code\":\"VPMF+G3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+G3\"},\"price_level\":1,\"rating\":3.6,\"reference\":\"ChIJQxxoogwm9ocRDJmn9hKkt8Q\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":42,\"vicinity\":\"10 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8845246,\"lng\":-93.2773587},\"viewport\":{\"northeast\":{\"lat\":44.88587443029149,\"lng\":-93.27614551970848},\"southwest\":{\"lat\":44.88317646970849,\"lng\":-93.2788434802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"d9f96c65d9966dc96344ff0c67f03df42a8895a7\",\"name\":\"El Tejaban Mexican Grill\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/101828333674428774151\\\">Linda Lopez</a>\"],\"photo_reference\":\"CmRaAAAA9WB_94yl7srTBFblt4gNRxWIT_c8Tq8r3QCw09rbHzitw3FVfhieoJ1pv48Wqfe0Z2U3WUpHe1v6lJule1jmz2mLhrzsFh-Y5qssdTKoOld2k1XvATIYonrcXTnW95TVEhAygshFIRJikBkaTbPhJKAgGhRv2NRHS2hPS_K-hzMbA373X2rXJw\",\"width\":4032}],\"place_id\":\"ChIJp1wUwQwm9ocRcd4qhKaPxt8\",\"plus_code\":{\"compound_code\":\"VPMF+R3 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMF+R3\"},\"price_level\":2,\"rating\":4.1,\"reference\":\"ChIJp1wUwQwm9ocRcd4qhKaPxt8\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":713,\"vicinity\":\"6519 Nicollet Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88765220000001,\"lng\":-93.26733159999999},\"viewport\":{\"northeast\":{\"lat\":44.88900213029149,\"lng\":-93.26624416970849},\"southwest\":{\"lat\":44.8863041697085,\"lng\":-93.2689421302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"0f532d0931a607f5ab1bd45823a48ebe4fc01572\",\"name\":\"Wheel Fun Rentals\",\"photos\":[{\"height\":1365,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/108959973530893398684\\\">Wheel Fun Rentals</a>\"],\"photo_reference\":\"CmRaAAAAR7Y-BATZ1--V-LAMicKgjWNje3NiBKWko95w8jBRApWqn_9NSM4oSer72fZW4MNF8Gc8cIJS16XoLZZ3QYD4bNOdi5NCKzkXMSVczGkdRw8HWix_jg1GFWMXUxX1TS_uEhBzNOr3Ntume3r1_GFkZrfjGhTvtGQtvdTMhATHVjoUxlBTcClvBQ\",\"width\":2048}],\"place_id\":\"ChIJy2AyUAUm9ocRtZuDx8OvUh4\",\"plus_code\":{\"compound_code\":\"VPQM+33 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPQM+33\"},\"rating\":3.1,\"reference\":\"ChIJy2AyUAUm9ocRtZuDx8OvUh4\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"store\",\"establishment\"],\"user_ratings_total\":64,\"vicinity\":\"6335 Portland Avenue, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8939568,\"lng\":-93.2778624},\"viewport\":{\"northeast\":{\"lat\":44.8954572302915,\"lng\":-93.27639866970848},\"southwest\":{\"lat\":44.8927592697085,\"lng\":-93.2790966302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"a6084aa38730aafb3302ed8b41189d0ee9b44453\",\"name\":\"Q fanatic Artisan BBQ\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/108794747643944972579\\\">Bob Dadabo</a>\"],\"photo_reference\":\"CmRaAAAArAlDOATo6GQhMg37zYAc9hWylWiQrvCllrU-9KL63_gFgMe4UugHvhTdGvs6N5xfwQ3sClRsYgZ89eXpFTqECILE_VekqiMlNrqY4oHxqMoe6MqVmd3jKITJsli7IO9TEhCRY4if3hSTa39-LEpBBzSmGhRtNPl7R8VjJwSvUjzzrp6_qV8bZA\",\"width\":4032}],\"place_id\":\"ChIJxx5fzxQm9ocRMPiaoJ83nwk\",\"plus_code\":{\"compound_code\":\"VPVC+HV Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+HV\"},\"price_level\":2,\"rating\":4.7,\"reference\":\"ChIJxx5fzxQm9ocRMPiaoJ83nwk\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":614,\"vicinity\":\"6009 Nicollet Avenue, Minneapolis\"},{\"geometry\":{\"location\":{\"lat\":44.88310139999999,\"lng\":-93.2775521},\"viewport\":{\"northeast\":{\"lat\":44.88452203029149,\"lng\":-93.27620036970849},\"southwest\":{\"lat\":44.88182406970849,\"lng\":-93.2788983302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd44d818999d317424143a358445387723f69033\",\"name\":\"Lakes Buffet\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":2269,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/105659331289179066133\\\">Lakes Buffet</a>\"],\"photo_reference\":\"CmRaAAAAOF-hoGyzLwzn_3XPRST2MtAhqeOlvW48mJ5CTIdcKiyVGk0zLymJzDaJttc-SdABJhuvu6P2zXSHUxFPb69xe91QpjkrY0JpQePJv4Hv1Ox3VPvg5rM-IypA7Tonf6_PEhBXXS9Z1nEBAeLqDSb0BK43GhRLQI6_yjI4xWNjkDX6HWtYPgZUHQ\",\"width\":4032}],\"place_id\":\"ChIJ1QE6-nMm9ocRIcOziE6FA5k\",\"plus_code\":{\"compound_code\":\"VPMC+6X Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMC+6X\"},\"price_level\":2,\"rating\":3.8,\"reference\":\"ChIJ1QE6-nMm9ocRIcOziE6FA5k\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":772,\"vicinity\":\"9 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883877,\"lng\":-93.25058899999999},\"viewport\":{\"northeast\":{\"lat\":44.88548218029149,\"lng\":-93.24904376970849},\"southwest\":{\"lat\":44.88278421970849,\"lng\":-93.2517417302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"80d7657adb244518afc35c0809fd89e625185652\",\"name\":\"Panda Express\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/113742889776870864311\\\">Bella Grace</a>\"],\"photo_reference\":\"CmRaAAAAZe2uAj3j_N7WXLRBZSet465fBtnmSJvTbOm90v5rLDhELOxc-CQoiAaVYWNUdQ0YwdKqyxkgf6LU_8eGYioQOl7SrBXQ4uVKBDJ2R7WL9LzPx7UGuJspxEBpmP9ifb1WEhD7FXidN21e7PfwTxtcjCykGhTs2DSwNlA41P5ATL54eam6Tc-Euw\",\"width\":4032}],\"place_id\":\"ChIJESu31a0o9ocR2TwYm9IwSoE\",\"plus_code\":{\"compound_code\":\"VPMX+HQ Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMX+HQ\"},\"price_level\":1,\"rating\":3.8,\"reference\":\"ChIJESu31a0o9ocR2TwYm9IwSoE\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":292,\"vicinity\":\"1638 East 66th Street E, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.883969,\"lng\":-93.24833819999999},\"viewport\":{\"northeast\":{\"lat\":44.8854099302915,\"lng\":-93.24700296970848},\"southwest\":{\"lat\":44.8827119697085,\"lng\":-93.2497009302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd2b2ab189b8034b768839535c6da91a05ff5ccd\",\"name\":\"Five Guys\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":4032,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117274020802757750584\\\">Paulette Kilgore</a>\"],\"photo_reference\":\"CmRaAAAAkUYLKU0sIWOyg3ukXnTy9QDYhbon_v6vwJaO4sp2tur7RSpw_0tg9lfr6fhsto3N6p5_KJE08gHSsiBDfmC20u2P2pXYvSuaj056FrG6GoQfNFrcx0Fp-Q6f48Ej7BB5EhCuMaan-VkB67nCvyXakFUPGhQFyTYMFwOPXEiRhNO0I4hC-6PVCg\",\"width\":3024}],\"place_id\":\"ChIJ82zdI4Qm9ocRkSbDFYXLWgM\",\"plus_code\":{\"compound_code\":\"VQM2+HM Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HM\"},\"price_level\":2,\"rating\":4.3,\"reference\":\"ChIJ82zdI4Qm9ocRkSbDFYXLWgM\",\"scope\":\"GOOGLE\",\"types\":[\"meal_takeaway\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":548,\"vicinity\":\"1844 East 66th Street Suite 100, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8839582,\"lng\":-93.24851559999999},\"viewport\":{\"northeast\":{\"lat\":44.8853981302915,\"lng\":-93.24717931970848},\"southwest\":{\"lat\":44.88270016970851,\"lng\":-93.2498772802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"df59d034179ab09c9a5758086231a25bf2bc3ef1\",\"name\":\"Chipotle Mexican Grill\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1080,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/110907965834292552824\\\">A Hendrickson</a>\"],\"photo_reference\":\"CmRaAAAADOOXbiBvTTUklEWcrX61AE-bUzHVmqXzRNUMFKgF6Sh32SYjX7oZ3EhPf-Rs0ghM1xLXY8aSJkTQ2RvTdjAA--LZcFpTs-4OFfndk-YTMRxvjyB_v9IEL32lInoC_MyDEhDBk1gJBHfIxI4J07F2tJp1GhQGO33BV5TUWhGCxNhvzh_hkTAmUg\",\"width\":1920}],\"place_id\":\"ChIJ7T_X_a0o9ocRNzqdstQRrUg\",\"plus_code\":{\"compound_code\":\"VQM2+HH Richfield, Minnesota, United States\",\"global_code\":\"86P8VQM2+HH\"},\"price_level\":1,\"rating\":3.9,\"reference\":\"ChIJ7T_X_a0o9ocRNzqdstQRrUg\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":912,\"vicinity\":\"1830 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8838531,\"lng\":-93.28056289999999},\"viewport\":{\"northeast\":{\"lat\":44.88517613029149,\"lng\":-93.27931836970849},\"southwest\":{\"lat\":44.88247816970849,\"lng\":-93.2820163302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"dfa548c87ebff9e312b5f0cccef6af20fa76a75a\",\"name\":\"Burger King\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1080,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/106399984866392798901\\\">Tom B</a>\"],\"photo_reference\":\"CmRaAAAA-EIFUEQHTW0M1rR962Yn1G4JHYfKJHA045EPl5JGtJqZP2su5TG8i-o6A225i_GUltJQZKL5GSV2T3F7FM8U0CikU4_ngz0no5gFFq1w9LxoXXYwX7Q86Sf70YG7zOObEhCdKQMi4cAtvRirgiI9Lm6nGhQumSGrSIAsQaq-hhoNwsPb2Qvgaw\",\"width\":1920}],\"place_id\":\"ChIJvah2aHMm9ocRKpUbDd_7vTM\",\"plus_code\":{\"compound_code\":\"VPM9+GQ Richfield, Minnesota, United States\",\"global_code\":\"86P8VPM9+GQ\"},\"price_level\":1,\"rating\":3.4,\"reference\":\"ChIJvah2aHMm9ocRKpUbDd_7vTM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":363,\"vicinity\":\"96 West 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8831803,\"lng\":-93.2626615},\"viewport\":{\"northeast\":{\"lat\":44.8846934302915,\"lng\":-93.2613119697085},\"southwest\":{\"lat\":44.8819954697085,\"lng\":-93.26400993029151}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"cd72316db7c6c2f7b7caa54d39aab56830c727f5\",\"name\":\"i taco\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":1365,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/117140200442371672045\\\">jaime And Marcos i taco</a>\"],\"photo_reference\":\"CmRaAAAAzoCcdpPF_5YwViEc2odzn223vAPChV2meK0qTFu13tErEyquoYCFOLMrzkkk3J-IhnmXE0V-gpw7NDKfY1ravTkKHgsuJi1Cg1BxAPPPf6vxghF2lUNJdPyd_QAZbEAnEhCO7kE9_kyt1dNekHoYw284GhSsK2QFSDKLPl7hr9i7gus2X7GF1Q\",\"width\":2048}],\"place_id\":\"ChIJsbIgZqQn9ocRLAGNl1BWydI\",\"plus_code\":{\"compound_code\":\"VPMP+7W Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMP+7W\"},\"rating\":4.7,\"reference\":\"ChIJsbIgZqQn9ocRLAGNl1BWydI\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":29,\"vicinity\":\"813 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.88314810000001,\"lng\":-93.2620952},\"viewport\":{\"northeast\":{\"lat\":44.88454383029151,\"lng\":-93.26055216970849},\"southwest\":{\"lat\":44.88184586970851,\"lng\":-93.2632501302915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"40efc0c2c0430d1866320afef445ab34af6a56bf\",\"name\":\"Local Roots\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":3024,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/100726915532117426719\\\">B Johnson Photos Brenda Johnson</a>\"],\"photo_reference\":\"CmRaAAAAMD6Mcqjjj65PpofgmjhG1oImGaznGY22dBPcuDuqOGzMS1_4lxVzjtPZyY-5EjL8M8y1Rx9lyeZI-mzdvJ_4BPwQIkSH5qsbz2rENaHqDfj4u1UQ2HlY9S9liTgb51GBEhAYO_YJNUPrQq2kiNafRA1SGhTKSmFDQZogbAFn6Cz9bnu6UFQEqg\",\"width\":4032}],\"place_id\":\"ChIJ6SJlZwEm9ocR8gWPM6qIWSs\",\"plus_code\":{\"compound_code\":\"VPMQ+75 Richfield, Minnesota, United States\",\"global_code\":\"86P8VPMQ+75\"},\"price_level\":2,\"rating\":4.6,\"reference\":\"ChIJ6SJlZwEm9ocR8gWPM6qIWSs\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":336,\"vicinity\":\"817 East 66th Street, Richfield\"},{\"geometry\":{\"location\":{\"lat\":44.8926872,\"lng\":-93.278604},\"viewport\":{\"northeast\":{\"lat\":44.89403498029149,\"lng\":-93.2771400197085},\"southwest\":{\"lat\":44.8913370197085,\"lng\":-93.2798379802915}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png\",\"id\":\"7878f4b73288eb64c674ad963ecd0fbe88cd8730\",\"name\":\"The Patty Wagon, Best Burgers in South Minneapolis\",\"opening_hours\":{\"open_now\":true},\"photos\":[{\"height\":324,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/107665803766083058795\\\">The Patty Wagon, Best Burgers in South Minneapolis</a>\"],\"photo_reference\":\"CmRaAAAADaGerNAssI_aafnEskZzzXKynutWVO7IYo5VeYs9rqBKi3t_bXJgxD7rjiiksNEam26cfGz-l2HmURxH0OowyaFnH02eEsCwtHu-E4x_uq3WDzzxlDumZFFJmLdDrBLREhAnYt6aRoFGmDKBqpZ4AjveGhTWIYGb2BtZPxjdEwhC3H7TR-ADzw\",\"width\":432}],\"place_id\":\"ChIJeXu2VGsm9ocRXU4iEFSlzzw\",\"plus_code\":{\"compound_code\":\"VPVC+3H Minneapolis, Minnesota, United States\",\"global_code\":\"86P8VPVC+3H\"},\"price_level\":1,\"rating\":4.4,\"reference\":\"ChIJeXu2VGsm9ocRXU4iEFSlzzw\",\"scope\":\"GOOGLE\",\"types\":[\"bar\",\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":482,\"vicinity\":\"6042 Nicollet Avenue, Minneapolis\"}]",
                    response.content
                )            }
        }
    }

    @KtorExperimentalAPI
    @Test
    fun testCenter() {
        withTestApplication({
            (environment.config as MapApplicationConfig).apply {
                put("ktor.service.authUrl", "http://localhost:8081/v1/")
                put("ktor.service.locationUrl", "http://localhost:8081/v1/")
            }
            module(client = createMockedClient())
        }) {
            handleRequest(HttpMethod.Get, "/locations/center") {
                addHeader(HttpHeaders.ContentType, ContentType.Application.Json.toString())
                setBody(CenterRequest(listOf(LatLngRequest(44.889220, -93.2650))).toJson())
            }.apply {
                assertEquals(HttpStatusCode.OK, response.status())
                assertEquals(
                    "{\"lat\":44.9658,\"lng\":-93.1775}",
                    response.content
                )
            }
        }
    }
}